<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <record id="kami_sm_attendance_action" model="ir.actions.act_window">
    <field name="name">Atendimentos</field>
    <field name="res_model">kami_sm.attendance</field>
    <field name="view_mode">tree,form,kanban</field>
    <field name="context">{'search_default_available': True}</field>
  </record>

  <record id="kami_sm_attendance_view_tree" model="ir.ui.view">
    <field name="name">kami_sm.attendance.tree</field>
    <field name="model">kami_sm.attendance</field>
    <field name="arch" type="xml">
        <tree 
          string="Atendimentos"
          decoration-success="state == 'approved'"
          decoration-muted="state == 'done'"          
        >
          <field name="seller_id"/>
          <field name="client_id" context="{'res_partner_search_mode': 'customer'}"/>
          <field name="type_id"/>
          <field name="theme_id"/>
          <field name="partner_id" context="{'res_partner_search_mode': 'supplier'}"/>
          <field name="expected_audience"/>
          <field name="start_date"/>          
          <field name="total_cost"/>          
          <field name="state" invisible="1" />
        </tree>
    </field>
  </record>

  <record id="kami_sm_attendance_view_form" model="ir.ui.view">
    <field name="name">kami_sm.attendance.form</field>
    <field name="model">kami_sm.attendance</field>
    <field name="arch" type="xml">
      <form string="Atendimento">
        <header>        
          <button 
            name="action_approve_attendance"
            string="Aprovar"
            type="object"
            class="oe_highlight"
            states="new"
          />
          <button
            name="action_open_request_cancel"
            string="Solicitar Cancelamento"
            type="object"
            class="oe_highlight"
            states="new,approved"
          />
          <button
            name="action_cancel_attendance"
            string="Cancelar"
            type="object"
            class="oe_highlight"
            states="waiting;approved"
          />
          <button
            name="action_finish_attendance"
            string="Encerrar"
            type="object"
            class="oe_highlight"
            states="approved"
          />
          <field 
            name="state"            
            widget="statusbar"
            statusbar_visible="new,approved,done,waiting;canceled"
          />
        </header>     
        <sheet>          
          <group>
            <field name="client_id" context="{'res_partner_search_mode': 'customer'}"/>
            <field name="type_id"/> 
            <field name="theme_id"/> 
            <field name="start_date" string="Data"/>
          </group>          
          <group>
            <field name="partner_id" context="{'res_partner_search_mode': 'supplier'}"/>             
            <field name="expected_audience"/>
            <field name="stop_date" invisible="1"/>            
          </group>
          <notebook>
            <page string="Detalhes">
              <group>
                <field name="description"/>                              
              </group>
            </page>
            <page string="Custos">
              <group>
                <field name="total_cost"/>
                <field name="cost_ids">
                  <tree>
                    <field name="description"/>
                    <field name="cost_type"/>
                    <field name="partial"/>
                    <field name="cost"/>
                  </tree>
                </field>
              </group>
            </page>
            <page 
              string="Justificativa"
              attrs="{'invisible': [('cancellation_reason', '=', False)]}"
            >
              <group>
                <field 
                  name="cancellation_reason"
                  attrs="{
                    'readonly': [('state', 'in', ('waiting', 'canceled'))
                  ]}"
                />                
              </group>
            </page>                         
          </notebook>           
        </sheet>
        <div class="oe_chatter">
          <field name="message_follower_ids" widget="mail_followers"/>
          <field name="message_ids" widget="mail_thread"/>
        </div>
      </form>
    </field>
  </record>

  <record id="kami_sm_attendance_view_kanban" model="ir.ui.view">
    <field name="name">kami_sm.attendance.kanban</field>
    <field name="model">kami_sm.attendance</field>
    <field name="arch" type="xml">
      <kanban 
        default_group_by="state"
        records_draggable="false"
      >        
        <field name="state"/>
        <templates>
          <t t-name="kanban-box">
            <div class="oe_kanban_global_click">
              <div>
                <field name="client_id" context="{'res_partner_search_mode': 'customer'}"/>
              </div>
              <div>
                <field name="start_date"/>                
              </div>
              <div>
                <field name="partner_id" context="{'res_partner_search_mode': 'supplier'}"/>
              </div>
            </div>
          </t>
        </templates>
      </kanban>
    </field>
  </record>

  <record id="view_kami_sm_attendance_search" model="ir.ui.view">
    <field name="name">kami_sm.attendance.search</field>
    <field name="model">kami_sm.attendance</field>
    <field name="arch" type="xml">
      <search string="Atendimento">
        <field name="seller_id"/>
        <field name="client_id" context="{'res_partner_search_mode': 'customer'}"/>
        <field name="type_id"/>
        <field name="theme_id"/>
        <field name="partner_id" context="{'res_partner_search_mode': 'supplier'}"/>                        
        <separator/>
        <filter 
          string="Aguarando Aprovação"
          name="available"
          domain="[('state', '=', 'new')]"
        />
        <group expand="1" string="Group By">                 
          <filter 
            string="Tipo de Atendimento"
            name="attendance_type"
            context="{'group_by':'type_id'}"            
          />
          <filter 
            string="Tema do Atendimento"
            name="attendance_theme"
            context="{'group_by':'theme_id'}"            
          />
        </group>      
      </search>
    </field>
  </record>

  <record id="kami_sm_attendance_view_popup_form" model="ir.ui.view">
    <field name="name">kami_sm.attendance.popup.form</field>
    <field name="model">kami_sm.attendance</field>
    <field name="arch" type="xml">
      <form string="Solicitação de Cancelamento" create="false">
        <h3>Preencha a Justificativa para o Cancelamento:</h3>
        
        <group>
          <field name="cancellation_reason"/>
        </group>
        
        <group>
          <button
            name="action_request_cancel"
            string="Solicitar"
            type="object"
            class="oe_highlight"
          />  
          <button
            name="action_cancel_popup_attendance"
            string="Cancelar"
            type="object"
            class="oe_highlight"
          />
        </group>
        <footer></footer>        
      </form>
    </field>
  </record>

</odoo>
  